---
import { getCollection } from 'astro:content';
import Layout from '../../site-layouts/Layout.astro';

// 魔法: 全ての記事のURLを自動で作る
export async function getStaticPaths() {
  const blogEntries = await getCollection('thoughts');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <main class="min-h-screen bg-black text-gray-200 p-6 flex justify-center">
    <article class="prose prose-invert prose-lg max-w-3xl w-full mt-20">
      
      <!-- ヘッダー画像 -->
      {entry.data.cover && (
        <img 
          src={entry.data.cover} 
          alt={entry.data.title} 
          class="w-full h-96 object-cover rounded-2xl shadow-2xl mb-12"
          transition:name={`cover-${entry.slug}`} 
        />
      )}

      <!-- タイトル -->
      <h1 class="text-4xl md:text-5xl font-bold mb-4">{entry.data.title}</h1>
      
      <!-- メタデータ -->
      <div class="flex items-center gap-4 text-sm text-gray-500 mb-12 font-mono">
        <span>{entry.data.intuitionDate.toISOString().split('T')[0]}</span>
        <span class="px-2 py-0.5 border border-gray-700 rounded text-xs">CONFIDENCE: {entry.data.confidence}%</span>
      </div>

      <!-- 本文（画像や音楽もここに出ます） -->
      <div class="leading-relaxed space-y-6">
        <Content />
      </div>

      <!-- 戻るボタン -->
      <div class="mt-20 border-t border-gray-800 pt-10">
        <a href="/ja" class="text-gray-400 hover:text-white transition">← Back to Archive</a>
      </div>

    </article>
  </main>
</Layout>