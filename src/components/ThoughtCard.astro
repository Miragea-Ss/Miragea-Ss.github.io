---
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'thoughts'>;
}

const { post } = Astro.props;

// === アートロジック ===
const glowColor = post.data.confidence > 80 ? 'shadow-rose-900/60' : 'shadow-cyan-900/40';
const borderColor = post.data.confidence > 80 ? 'border-rose-500/30' : 'border-cyan-500/30';
---

<!-- ここが重要！全体をリンクタグ(a)で包みました -->
<a href={`/thoughts/${post.slug}`} class="block group">
  
  <article 
    class={`relative p-8 rounded-2xl border backdrop-blur-sm bg-black/50 transition-all duration-700 group-hover:scale-[1.02] shadow-2xl ${glowColor} ${borderColor}`}
  >
    <!-- カバー画像があれば表示 -->
    {post.data.cover && (
      <img 
        src={post.data.cover} 
        alt={post.data.title} 
        class="w-full h-48 object-cover rounded-lg mb-6 opacity-80 group-hover:opacity-100 transition duration-500" 
      />
    )}

    <!-- 日付（Miragea美学：メタデータは控えめに） -->
    <div class="text-xs font-mono text-gray-600 mb-4 tracking-widest">
      {post.data.intuitionDate.toISOString().split('T')[0]}
    </div>
    
    <!-- Confidenceを視覚的に表現（光の強度として） -->
    <div 
      class="absolute top-4 right-4 w-3 h-3 rounded-full opacity-60"
      style={`box-shadow: 0 0 ${post.data.confidence * 0.2}px ${post.data.confidence * 0.15}px ${post.data.confidence > 80 ? 'rgba(251, 113, 133, 0.8)' : 'rgba(103, 232, 249, 0.8)'};`}
      title={`Confidence: ${post.data.confidence}%`}
    ></div>

    <!-- タイトル -->
    <h2 class="text-2xl md:text-3xl font-bold text-gray-100 mb-4 leading-tight group-hover:text-white transition">
      {post.data.title}
    </h2>
    
    <!-- 雰囲気 -->
    <p class="text-sm text-gray-400 italic mb-6 border-l-2 border-gray-700 pl-4">
      "{post.data.atmosphere}"
    </p>

    <!-- タグ -->
    <div class="mt-4 flex gap-2">
      {post.data.topics.map((tag) => (
        <span class="text-xs border border-white/10 px-2 py-1 rounded text-gray-400">
          #{tag}
        </span>
      ))}
    </div>
  </article>

</a>

<!-- AI用データ -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "author": { "@type": "Person", "name": "Miragea" },
  "datePublished": post.data.intuitionDate,
  "description": post.data.atmosphere
})} />