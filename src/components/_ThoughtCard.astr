---
// src/components/ThoughtCard.astro
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'thoughts'>;
  lang?: string;
}

const { post, lang = 'ja' } = Astro.props;

// =========================================================
// ğŸ¨ ç¾å­¦ãƒ­ã‚¸ãƒƒã‚¯ï¼šæ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€Œè‰²ã€ã¨ã€Œå…‰ã€ã‚’ç”Ÿæˆã™ã‚‹
// =========================================================

// 80%ä»¥ä¸Šã¯ã€Œæ¿€ã—ã„æ„Ÿæƒ…ï¼ˆèµ¤ï¼‰ã€ã€ãã‚Œä»¥ä¸‹ã¯ã€Œé™å¯‚ãªçŸ¥è¦šï¼ˆé’ï¼‰ã€
const isIntense = post.data.confidence > 80;

// 1. èƒŒæ™¯è‰²ï¼ˆã‚¬ãƒ©ã‚¹ã®ã‚ˆã†ãªåŠé€æ˜ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
const bgStyle = isIntense
  ? 'bg-gradient-to-br from-rose-950/30 to-black/80 hover:from-rose-900/40'
  : 'bg-gradient-to-br from-cyan-950/20 to-black/80 hover:from-cyan-900/30';

// 2. å…‰ã®æ»²ã¿ï¼ˆãƒœãƒ¼ãƒ€ãƒ¼ã¨ã‚·ãƒ£ãƒ‰ã‚¦ï¼‰
const glowStyle = isIntense
  ? 'border-rose-500/20 shadow-[0_0_30px_-5px_rgba(244,63,94,0.1)] hover:shadow-[0_0_50px_-10px_rgba(244,63,94,0.3)] hover:border-rose-400/40'
  : 'border-cyan-500/20 shadow-[0_0_30px_-5px_rgba(34,211,238,0.1)] hover:shadow-[0_0_50px_-10px_rgba(34,211,238,0.3)] hover:border-cyan-400/40';

// 3. å‘¼å¸ã™ã‚‹å…‰ã®ç‚¹
const dotColor = isIntense ? 'bg-rose-500 shadow-rose-500/50' : 'bg-cyan-400 shadow-cyan-400/50';

// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const dateStr = post.data.intuitionDate.toISOString().split('T')[0];
---

<!-- ã‚«ãƒ¼ãƒ‰å…¨ä½“ï¼šè§’ã‚’å¤§ããä¸¸ã‚(rounded-3xl)ã€æ°´ã®ã‚ˆã†ãªå‹•ã(duration-1000)ã‚’ä¸ãˆã‚‹ -->
<article 
  class={`
    group relative flex flex-col h-full
    p-8 rounded-[2rem] /* â†ã“ã“ãŒé‡è¦ï¼šç¡¬ã•ã‚’æ¶ˆã™å¤§ããªä¸¸ã¿ */
    border backdrop-blur-md
    transition-all duration-1000 ease-out /* â†ã“ã“ãŒé‡è¦ï¼šæ°´ã®ã‚ˆã†ãªã‚†ã£ãã‚Šã—ãŸæµã‚Œ */
    hover:-translate-y-2 hover:scale-[1.01]
    ${bgStyle} ${glowStyle}
  `}
>
  
  <!-- ============================================ -->
  <!-- ãƒªãƒ³ã‚¯ã‚¨ãƒªã‚¢Aï¼šã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Œæ–‡ç« ã€ã‚’èª­ã‚€ -->
  <!-- ============================================ -->
  <a href={`/${lang}/thoughts/${post.slug}`} class="block flex-grow group/link z-10">
    
    <!-- ã‚«ãƒãƒ¼ç”»åƒï¼ˆã‚ã‚Œã°è¡¨ç¤ºï¼‰ -->
    {post.data.cover && (
      <div class="relative overflow-hidden rounded-xl mb-6 shadow-lg">
        <img 
          src={post.data.cover} 
          alt={post.data.title} 
          class="w-full h-48 object-cover opacity-80 group-hover/link:opacity-100 transition duration-700 transform group-hover/link:scale-105" 
        />
        <!-- ç”»åƒä¸Šã®å¾®ç´°ãªãƒã‚¤ã‚º -->
        <div class="absolute inset-0 bg-black/20 group-hover/link:bg-transparent transition-colors duration-700"></div>
      </div>
    )}

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ï¼ˆæ—¥ä»˜ã¨å…‰ç‚¹ï¼‰ -->
    <div class="flex items-center justify-between mb-4">
      <span class="font-mono text-xs tracking-[0.2em] text-gray-500 group-hover/link:text-gray-300 transition-colors duration-500">
        {dateStr}
      </span>
      
      <!-- æ„Ÿæƒ…ã®å…‰ç‚¹ï¼ˆæ˜æ»…ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ -->
      <div class="relative">
        <div class={`w-2 h-2 rounded-full ${dotColor} relative z-10 shadow-[0_0_10px_currentColor]`}></div>
        <div class={`absolute inset-0 rounded-full ${dotColor} animate-ping opacity-50 duration-[3000ms]`}></div>
      </div>
    </div>

    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <h2 class="text-3xl font-serif font-medium text-gray-200 mb-4 leading-tight group-hover/link:text-white transition-colors duration-500">
      {post.data.title}
    </h2>
    
    <!-- é›°å›²æ°—ï¼ˆAtmosphereï¼‰ -->
    <p class="text-sm text-gray-400 italic font-light tracking-wide pl-4 border-l border-gray-700/50 group-hover/link:border-gray-500 transition-colors duration-700 mb-8">
      "{post.data.atmosphere}"
    </p>
  </a>

  <!-- ============================================ -->
  <!-- ãƒªãƒ³ã‚¯ã‚¨ãƒªã‚¢Bï¼šã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Œç”»åƒç”»å±¤ã€ã¸æ½œã‚‹ -->
  <!-- ============================================ -->
  <div class="mt-auto pt-4 border-t border-white/5 relative z-20 flex flex-wrap gap-2">
    {post.data.topics.map((tag) => (
      <a 
        href={`/${lang}/gallery/${tag}`} 
        class="tag-pill"
        title={`Dive into #${tag} layer`}
      >
        #{tag}
      </a>
    ))}
  </div>

  <!-- èƒŒæ™¯æ¼”å‡ºï¼šå¾®ç´°ãªã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆï¼ˆè³ªæ„Ÿï¼‰ -->
  <div class="absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] mix-blend-overlay rounded-[2rem]"></div>

</article>

<style>
  /* ã‚¿ã‚°ã®ãƒ‡ã‚¶ã‚¤ãƒ³ï¼šãƒœã‚¿ãƒ³ã£ã½ã•ã‚’æ¶ˆã—ã€æµ®éŠã™ã‚‹ç²’å­ã®ã‚ˆã†ã« */
  .tag-pill {
    font-size: 0.75rem;
    padding: 0.3rem 0.8rem;
    border-radius: 999px;
    
    /* åŠé€æ˜ã®ã‚¬ãƒ©ã‚¹è³ªæ„Ÿ */
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    color: #888;
    
    text-decoration: none;
    transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    letter-spacing: 0.05em;
  }

  /* ãƒ›ãƒãƒ¼æ™‚ã®æŒ™å‹•ï¼šç™½ãç™ºå…‰ã—ã¦å°‘ã—æµ®ã */
  .tag-pill:hover {
    background: rgba(255, 255, 255, 0.15);
    color: #fff;
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
</style>